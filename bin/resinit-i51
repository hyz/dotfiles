#!/bin/sh

APATH=$1
NM=`basename $1`

SCRES=$2
SRC=$3

if [ ! -d "$APATH" -o -z "$SCRES" ]; then
    exit 1
fi
if [ -z "$SRC" ]; then
    SRC=$APATH/Resource/$SCRES
else
    SRC=$APATH/$SRC
fi
if [ ! -d "$SRC" ]; then
    exit 2
fi

BIN=$APATH/Resource/BIN
CSV=$BIN/bin.csv

awk -F= 'NF==2{print $1","$2".i51G"}' <&0 >$CSV

/bin/rm -vf $BIN/*.png
cut -d, -f2- <$CSV | xargs -I'{}' basename '{}' .i51G |xargs -I'{}' /bin/cp -vt $BIN $SRC/'{}'.png

cat $CSV
awk -F, --assign ORS= 'BEGIN{print "{"}NR==1{print $1}NR>1{print ","$1}END{print "}"}' <$CSV
echo

V=`cat $APATH/Resource/version.ini`
awk 'END{print V+1}' V=$V <<<'' |tee $APATH/Resource/version.ini

cygpath -a -w $APATH/../../i51TOOL/Image
cygpath -a -w $BIN
echo cp -v $APATH/$NM.re $SRC/../`basename $SRC`.re

